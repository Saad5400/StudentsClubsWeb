@using StudentsClubsWeb.Utilities
@model StudentsClubsWeb.Areas.Student.Models.CreateClubVM
@{
    ViewData["Title"] = "نادي جديد";
    TempData[SD.NavActive.NewClub] = SD.NavActive.Activee;
}
<div class="container">
    <h2 class="mt-4">
        سجل نادي جديد
    </h2>
    <form method="post" asp-area="Student" asp-controller="Club" asp-action="CreatePOST">
        <div class="row">
            <div class="col-lg-4 col-md-12 mt-3">
                <label asp-for="Club.Name" class="form-label">اسم النادي</label>
                <input asp-for="Club.Name" type="text" class="form-control" placeholder="ادخل الاسم">
                <span asp-validation-for="Club.Name" class="text-danger"></span>
                @* <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small> *@
            </div>
            <div class="col-lg-4 col-md-6 mt-3">
                <label class="form-label">قائمة العلامات السابقة</label>
                <select id="tagSelect" class="form-select" onchange="appendTagToInput(this);">
                    <option disabled selected>اختر اي علامة لاضافتها</option>
                    @{
                        foreach (var tag in Model.TagsList.DistinctBy(t => t.Title).Where(t => t.Group == SD.TagGroup.Club))
                        {
                            <option>@tag.Title</option>
                        }
                    }
                </select>
            </div>
            <div class="col-lg-4 col-md-6 mt-3">
                <label asp-for="Tags" class="form-label">ادخل كل علامة وافصل بينهم باستعمال "-"</label>
                <input asp-for="Tags" id="tagInput" class="form-control" placeholder="حاسب - ترفيهي - علمي">
                <span asp-validation-for="Tags" class="text-danger"></span>
            </div>
            <div class="col-lg-4 col-md-6 mt-3">
                <label asp-for="City" class="form-label">اختر من المدن المسجلة او ادخل مدينة جديدة</label>
                <div class="row">
                    <div class="col-md-6 mb-2 mb-lg-0 mb-md-0 ps-md-1">
                        <select class="form-select" onchange="setCityInput(this);">
                            <option selected disabled>اختر المدينة</option>
                            @foreach (var city in Model.Cities.DistinctBy(t => t.Title))
                            {
                                <option>@city.Title</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-6 pe-md-1">
                        <input id="cityInput" class="form-control" asp-for="City" placeholder="ادخل المدينة" />
                    </div>
                </div>
                <span asp-validation-for="City" class="text-danger"></span>
            </div>

            <div class="col-lg-4 col-md-6 mt-3">
                <label asp-for="School" class="form-label">اختر من الجهات المسجلة او ادخل جهة جديدة</label>
                <div class="row">
                    <div class="col-md-6 mb-2 mb-lg-0 mb-md-0 ps-md-1">
                        <select class="form-select" onchange="setSchoolInput(this);">
                            <option selected disabled>اختر الجهة</option>
                            @foreach (var school in Model.Schools.DistinctBy(t => t.Title))
                            {
                                <option>@school.Title</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-6 pe-md-1">
                        <input id="schoolInput" class="form-control" asp-for="School" placeholder="ادخل الجهة" />
                    </div>
                </div>
                <span asp-validation-for="School" class="text-danger"></span>
            </div>
            <div class="col-lg-4 col-md-6 mt-3 form-group">
                <label>صورة النادي</label>
                <div class="row">
                    <div class="col-6">
                        <input id="myImageInput" type="file" />
                    </div>
                    <div class="col-6">
                        <input id="myImageUrlInput" dir="rtl" class="form-control" placeholder="او ادخل الرابط" type="url" />
                    </div>
                </div>
                <input asp-for="Club.Image" hidden="" id="realImageInput" />
                <span asp-validation-for="Club.Image" class="text-danger"></span>
            </div>
            <div class="form-group" hidden id="imagePreviewDiv">
                <label>
                    معاينة الصورة
                    <a class="btn btn-danger" onclick="removePostImage()">
                        حذف الصورة
                    </a>
                </label>
                <ul class="grid-list">
                    <li>
                        <div class="recent-post-card">
                            <figure class="card-banner img-holder"
                                    style="--width: 50; --height: 50">
                                <img id="imagePreview"
                                     width="50"
                                     height="50"
                                     loading="lazy"
                                     class="img-cover" />
                            </figure>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="col-lg-12 col-md-12 mt-3">
                <label asp-for="Club.Description" class="form-label">وصف النادي</label>
                <textarea asp-for="Club.Description" class="form-control" placeholder="ادخل الوصف"></textarea>
                <span asp-validation-for="Club.Description" class="text-danger"></span>
            </div>
        </div>
        <div class="row my-2 mx-0">
            <button type="submit" class="form-control btn btn-primary">
                تسجيل
            </button>
        </div>
    </form>
</div>


        
        
@section Scripts
{
    <script>
        function appendTagToInput(caller) {
            let tagInput = document.getElementById('tagInput');
            tagInput.value += caller.value + " - ";
            caller.selectedIndex = 0;
        }

        function setCityInput(caller) {
            let cityInput = document.getElementById('cityInput');
            cityInput.value = caller.value;
            caller.selectedIndex = 0;
        }

        function setSchoolInput(caller) {
            let schoolInput = document.getElementById('schoolInput');
            schoolInput.value = caller.value;
            caller.selectedIndex = 0;
        }
    </script>
    <script>
        function imageToBase64String(imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(imageFile);
                reader.onload = () => {
                    const base64String = reader.result.split(",")[1];
                    resolve(base64String);
                };
                reader.onerror = (error) => reject(error);
            });
        }

        function updateRealImageInput(value) {
            const realImageInput = document.getElementById("realImageInput");
            const imagePreviewDiv = document.getElementById("imagePreviewDiv");
            imagePreviewDiv.hidden = false;
            realImageInput.value = value;
            updateImagePreview(value);
        }
        function updateImagePreview(value) {
            const imagePreview = document.getElementById("imagePreview");
            imagePreview.src = value;
        }

        function removePostImage() {
            const imagePreviewDiv = document.getElementById("imagePreviewDiv");
            const myImageInput = document.getElementById("myImageInput");
            const myImageUrlInput = document.getElementById("myImageUrlInput");
            myImageInput.value = "";
            myImageUrlInput.value = "";
            updateRealImageInput("");
            imagePreviewDiv.hidden = true;
        }

        $("#myImageInput").on("change", async function () {
            var file = this.files[0];
            const base64String = "data:image/png;base64," + await imageToBase64String(file);
            // Perform action with the file here
            updateRealImageInput(base64String);

            document.getElementById("myImageUrlInput").value = "";
        });

        $("#myImageUrlInput").on("change", async function () {
            updateRealImageInput(this.value);

            document.getElementById("myImageInput").value = "";
        });
    </script>
    <partial name="_ValidationScriptsPartial"/>
}
